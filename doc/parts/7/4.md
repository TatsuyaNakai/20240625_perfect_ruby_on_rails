## テストに関するコラム


### テストコード生成

```
$ rails g test_unit:scaffold model
create  test/controllers/tickets_controller_test.rb
create  test/system/tickets_test.rb
```

CRUD用のシステムテスト、およびコントローラーの機能テストのテンプレートを生成します。

ただ、テスト用のファイルを生成するのとは異なり、単純なCRUDのテストコードも添えて生成されているため、便利です。
コードの内容については、scaffoldコマンドを実行した時と同じものが生成されます。

しかし、現在の標準では、`conrtoller`配下にテストを記述することはなく、`request`配下にテストを記載することが一般的になっていますので、運用しているアプリケーションを鑑みてご使用ください。


### setup, teardown

minitestにおいて、事前準備と後処理を行うコマンドがあります。(Rspecにも同様のコマンドがあります。)

~~~~Ruby
class XXXTest < ApplicationSystemTestCase
  setup do
    # ...事前に実施したい処理を記載します。
  end

  test 'xxx' do
    
  end
end
~~~~

複数のテストで共通した前処理が必要な場合は、使用することができます。


### travel_toで時間制御

**Rails**には、時間を制御してテストを実施するために`travel_to`というヘルパーが用意されています。

~~~~Ruby
travel to Time.zone.now + 2.day
# 現在時刻が制御されています。

travel_back
# 現在時刻が正常に戻っています。

travel_to Time.zone.now + 2.day do
  # 時間制御後に行いたい処理を記述します。(今回でいうと2日後)
end
~~~~

`travel_to`を実行すると、以降の処理にて現在時刻が制御されます。(戻すためには、`travel_back`する必要があります。)
また、ブロックを設けて実行すると、そのブロック内においてのみ現在時刻が制御されます。

他にも時間制御についてメソッドが存在するので[こちら](https://edgeapi.rubyonrails.org/classes/ActiveSupport/Testing/TimeHelpers.html)より確認してください。


### インテグレーションテストのポジション

コントローラーテスト(リクエストテスト)と混合されがちなテストですが、明確に区別することができます。それは、**インテグレーションテストは、複数のリクエストにまたがるテストを書くためのもの**という事です。

パスAにリクエストしてから、パスBにリクエストする。といったワークフローをテストすることができます。アプリケーションとしての流れを検証したい場合において、複数コントローラがまたがる必要がある時は、インテグレーションテストに記載するようにしてください。
