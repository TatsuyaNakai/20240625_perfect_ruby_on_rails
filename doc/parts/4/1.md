## Webpackerを使用してJavaScriptを管理する


### Webpackerの概要

WebpackをRailsから扱いやすくするためのラッパーです


### Webpackとは

1. JSファイルを1つにまとめる
2. 古いJSのコード(ES2015以降のコードをES5に変換)
3. ホットリロードを実現

サーバーサイドの開発者として活動していると、フロントエンドのノウハウがなくて困る場合がしばしばあります。

その時に、Webpackerを使うと、Webpackの設定を大枠を事前に用意してもらった上で、ところどころの実装だけで済むのが利点です。


### Webpackerでの開発箇所と、実際に呼び出されるファイル

JavaScriptの開発をする場合、Sprocketsで利用していた`app/assets/javascripts`でななく、`app/javascript/`配下で実装を行います。

実装記載箇所
|  |  |
| --- | --- |
| app/javascript/packs | Action Cable以外のJSの実装 |
| app/javascript/channels | Action Cableに関するJSの実装 |

ここで実装したソースコードをWebpackerでコンパイルして、`public/packs/js`へ出力します。

出力されたファイル名は`[ファイル名]-xxxxx.js`となりますが、xxxxxの部分についてはキャッシュ対策で保存内容によって変化します。（フィンガープリント：ファイル名が変わるとブラウザはキャッシュを利用できずに再読み込むする機能を利用している。）


### 実装方法

ディレクトリ構成自体は開発者に委ねられていますが、`application.js`には以下の記載がありました。

```
This file is automatically compiled by Webpack, along with any other files
present in this directory. You're encouraged to place your actual application logic in
a relevant structure within app/javascript and only use these pack files to reference
that code so it'll be compiled.

# このファイルは、このディレクトリにある他のファイルとともに、Webpack によって自動的にコンパイルされます。実際のアプリケーション ロジックを app/javascript 内の関連する構造に配置し、そのコードを参照するためにこれらのpackファイルのみを使用してコンパイルされるようにすることをお勧めします。
```

上記の内容に準ずる場合は、以下のように実装します。

1. `app/javascript/[new_folder]/index.js`の作成、および実装を行います
2. `app/javascript/packs/application.js`にて以下を記述する。

~~~~JavaScript
require('[new_folder]') // app/javascript/[new_folder]/index.js　の読み込み
~~~~


### 設定ファイル

| パス | 内容 |
| --- | --- |
| app/javascript/packs | コンパイルされるファイルを置く場所(推奨はapplication.jsのみ) |
| app/javascript | application.jsから読み込まれるモジュールを配置する場所 |
| config/webpacker.yml | Webpackの設定ファイル。アプリケーションを立ち上げる上での設定 |
| config/webpack/*.js | webpackの設定を出力するファイル。アプリケーションの中のJSに関する領域のみを設定<br>開発環境だけに必要な検証用のライブラリなどはこちらに定義する。 |
| babel.config.js | babelの設定ファイル |
| .browserlistrc | コンパイル対象となるブラウザを設定するファイル |


### CSSや画像をWebpackerで管理する

CSSや画像は基本的にSplocketsで管理している。どうしてもの場合はWebpackerでも管理可能


### Webpackerの設定を拡張する


#### loaderの追加

**loaderとは？**

loaderとは、WebpackがJavaScript以外のファイルをJavaScriptで解釈する方法を定義します。


##### erbの場合

```
$ rails webpacker:install:erb
```

他にも、CSS, Sass, ファイルローダーなどが存在します。

追加したい場合は`config/webpack/loaders`にて定義ファイルを追記し、`config/webpack/environment.js`にて読み込みます。

`config/webpack/environment.js`に記載された内容は各環境で読み込まれるので全環境に対応したい場合はこちらでOK

特定の環境のみ反映させたい場合、`[env].js`に修正するようにしてください。

`app/javascript`配下で新しいディレクトリを作成後、`___.js.[loaderで追加した拡張子]`を実装します。


#### pluginの追加

**pluginとは？**

機能を追加したり、既存の機能を拡張する事ができます。


##### jQueryの場合

```
$ yarn add jquery
```

`config/webpack/plugin/provide.js`を作成し、プラグインを追加する処理を記載します。

loaderのケースと同じように、`config/webpack/enviroment.js`で読み込みます。

Webpackerが管理している、`app/javascript`配下でjQueryが使用できるようになります。
